@model IEnumerable<VideoRental.Models.Movie>
@{
    ViewBag.Title = "Index";
}


<h2>Movies</h2>


@Html.ActionLink("New Movie", "MovieForm", "Movies", new { @class = "btn btn-primary" })

<br />

<table id="mainMovieTable" class="table">
    <thead>
        <tr>
            <th>Movies names</th>
            <th>Genre</th>
            <th>Delete</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var movie in Model)
        {
            <tr>
                <td>@Html.ActionLink(movie.Name,"Edit","Movies",new { id= movie.Id },null)</td>
                <td>@movie.Genre.Name</td>
                <td><button data-movie-id="@movie.Id" class="movieDelBtn btn btn-danger">Delete</button></td>
            </tr>
        }
    </tbody>
</table>

@section scripts{
    
    <script>

        $("#mainMovieTable .movieDelBtn").on("click", function () {

            let movieDelBtn = $(this);

            bootbox.confirm("Are You Want To Delete This Movie?", function (result) {
                if (result) {
                    $.ajax({
                        url: "api/movies/" + movieDelBtn.attr("data-movie-id"),
                        method: "DELETE",
                        success: function () {
                            console.log("success");
                            movieDelBtn.parents("tr").remove();
                        }
                    })
                }
                


            });

        });

    </script>

    }
